<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù„Ù‡ Ø£ÙˆÙ„Ø§Ù‹</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap');
        body { font-family: 'Amiri', serif; background-color: #fcf9f2; color: #4a342e; margin: 0; padding: 15px; text-align: center; }
        .container { max-width: 500px; margin: auto; }
        .header { padding: 20px 0; border-bottom: 2px double #d4af37; margin-bottom: 20px; }
        .logo { font-size: 2.5em; font-weight: bold; color: #8b4513; margin: 0; }
        .section { display: none; animation: fadeIn 0.5s; }
        .active { display: block; }
        
        .name-row { display: flex; align-items: center; gap: 8px; margin-bottom: 10px; width: 100%; }
        .name-btn { flex-grow: 1; background: #fff; border: 1px solid #d4af37; padding: 15px; border-radius: 10px; cursor: pointer; color: #8b4513; font-weight: bold; font-family: 'Amiri'; }
        
        .edit-btn { background: #ffc107; border: none; padding: 10px; border-radius: 8px; cursor: pointer; }
        .del-btn { background: #dc3545; color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer; }

        .article-box { background: #fff; padding: 20px; border-radius: 15px; text-align: justify; border: 1px solid #eaddca; margin-top: 20px; line-height: 1.8; white-space: pre-line; }
        .back-btn { background: #d4af37; color: white; border: none; padding: 12px; border-radius: 8px; margin-top: 20px; cursor: pointer; font-weight: bold; width: 100%; font-family: 'Amiri'; }
        
        #adminPanel { display: none; margin-top: 20px; padding: 15px; border: 2px solid #8b4513; border-radius: 15px; background: #f0f0f0; text-align: right; }
        .admin-input { width: 100%; padding: 10px; margin: 5px 0; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box; font-family: 'Amiri'; }
        
        .comment-item { background: white; padding: 10px; border-radius: 8px; margin-top: 10px; border-right: 4px solid #d4af37; text-align: right; font-size: 0.9em; }
        .points-box { background: #fffde7; padding: 15px; border-radius: 12px; border: 1px solid #fdd835; margin-top: 15px; text-align: right; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <div id="home" class="section active">
        <div class="header">
            <h1 class="logo">Ø§Ù„Ù„Ù‡ Ø£ÙˆÙ„Ø§Ù‹</h1>
            <p>"Ø³ÙŠØ±ÙˆØ§ Ø¥Ù„Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ø±Ø¬Ù‰ ÙˆÙ…ÙƒØ§Ø³ÙŠØ±"</p>
        </div>
        <button class="name-btn" style="background:#8b4513; color:white; width:100%" onclick="showSection('namesList')">ğŸ“– Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ø¹Ø±ÙØ©</button>
        <button class="name-btn" style="margin-top:10px; width:100%" onclick="showSection('publicStories')">ğŸ’¬ Ù…ÙˆØ§Ù‚ÙÙƒÙ… Ù…Ø¹ Ø§Ù„Ù„Ù‡</button>

        <div id="adminPanel">
            <h3 style="color:#8b4513; margin-top:0;">ğŸ›  Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰</h3>
            <input type="text" id="newName" class="admin-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ù‡">
            <textarea id="newContent" class="admin-input" style="height:80px" placeholder="Ø§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ"></textarea>
            <textarea id="newPoints" class="admin-input" style="height:60px" placeholder="Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (ÙƒÙ„ Ù†Ù‚Ø·Ø© ÙÙŠ Ø³Ø·Ø±)"></textarea>
            <button class="name-btn" style="background:#28a745; color:white; width:100%" onclick="addNewData()">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœ“</button>
            <button class="name-btn" style="background:#dc3545; color:white; width:100%; margin-top:5px; font-size:0.8em;" onclick="resetAllNames()">âš ï¸ Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙˆØ§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø§Ù„ØµÙØ±</button>
        </div>
    </div>

    <div id="namesList" class="section">
        <h2 style="color:#8b4513;">Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ù‡ Ø§Ù„Ø­Ø³Ù†Ù‰</h2>
        <div id="mainGrid"></div>
        <button class="back-btn" onclick="showSection('home')">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="article" class="section">
        <h2 id="articleTitle" style="color:#8b4513;"></h2>
        <div class="article-box" id="articleContent"></div>
        <button class="name-btn" style="width:100%; margin-top:15px; background:#d4af37; color:white;" onclick="showPoints()">ğŸ’¡ Ù†Ù‚Ø§Ø· Ø¹Ù…Ù„ÙŠØ© Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„Ø§Ø³Ù…</button>
        <div style="margin-top:20px; text-align:right;">
            <strong>âœï¸ Ø£ÙƒØªØ¨ Ù…ÙˆÙ‚ÙÙƒ:</strong>
            <textarea id="userStory" style="width:100%; height:70px; margin-top:5px; padding:10px; border-radius:8px; border:1px solid #ddd; font-family:'Amiri';"></textarea>
            <button class="name-btn" style="width:100%; margin-top:10px; background:#8b4513; color:white;" onclick="saveStory()">Ù†Ø´Ø± Ø§Ù„Ù…ÙˆÙ‚Ù</button>
            <div id="storiesList"></div>
        </div>
        <button class="back-btn" onclick="showSection('namesList')">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="pointsSection" class="section">
        <div class="points-box">
            <h4 style="color:#8b4513;">ğŸ“ Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„Ø§Ø³Ù… ÙÙŠ Ø§Ù„Ù‚Ù„Ø¨:</h4>
            <p style="font-size:0.85em; color:#6d4c41; margin-bottom:10px;">Â« Ø³Ù„ÙˆÙƒÙŠØ§Øª Ø¨Ø³ÙŠØ·Ø© Ù„ÙƒÙ† Ù„Ù‡Ø§ Ø£Ø«Ø± ÙƒØ¨ÙŠØ± Â»</p>
            <ul id="pointsList" style="list-style-type:disc; padding-right:20px; line-height:1.6; text-align:right;"></ul>
        </div>
        <button class="back-btn" onclick="showSection('article')">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="publicStories" class="section">
        <h2 style="color:#8b4513;">Ù‚ØµØµ Ù…Ù† ÙˆØ§Ù‚Ø¹ Ø§Ù„ÙŠÙ‚ÙŠÙ†</h2>
        <div id="allPublicStories"></div>
        <button class="back-btn" onclick="showSection('home')">Ø±Ø¬ÙˆØ¹</button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    const ADMIN_ID = 8421694319; // Ø§Ù„Ø§ÙŠØ¯ÙŠ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
    let currentName = "";

    // Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (ØªØ¸Ù‡Ø± ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø°Ø§ÙƒØ±Ø© ÙØ§Ø±ØºØ©)
    const defaultData = {
        "Ø§Ù„Ù„Ù‡": { content: "Ù‡Ùˆ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£Ø¹Ø¸Ù…...", points: ["ØªØ¹Ø¸ÙŠÙ… Ø§Ù„Ù„Ù‡ ÙÙŠ Ø§Ù„Ù‚Ù„Ø¨"] },
        "Ø§Ù„Ø±Ø­Ù…Ù†": { content: "ÙˆØ§Ø³Ø¹ Ø§Ù„Ø±Ø­Ù…Ø©...", points: ["Ø§Ù„Ø±Ø­Ù…Ø© Ø¨Ø§Ù„Ø®Ù„Ù‚"] },
        "Ø§Ù„Ø±Ù‚ÙŠØ¨": { content: "Ø±Ù‚ÙŠØ¨ Ø¹Ù„ÙŠÙƒ ÙÙŠ ÙƒÙ„ Ø­Ø§Ù„...", points: ["Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù†ÙØ³"] }
    };

    function checkAdmin() {
        return (tg.initDataUnsafe.user && tg.initDataUnsafe.user.id === ADMIN_ID);
    }

    if (checkAdmin()) {
        document.getElementById('adminPanel').style.display = 'block';
    }

    // Ø¯Ø§Ù„Ø© Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø£Ùˆ ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ø£ÙˆÙ„ Ù…Ø±Ø© ÙÙ‚Ø·
    function getAllData() {
        let stored = localStorage.getItem('app_names_data');
        if (!stored) {
            localStorage.setItem('app_names_data', JSON.stringify(defaultData));
            return defaultData;
        }
        return JSON.parse(stored);
    }

    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id === 'namesList') renderNames();
        if(id === 'publicStories') renderPublicStories();
        window.scrollTo(0,0);
    }

    function addNewData() {
        const name = document.getElementById('newName').value;
        const content = document.getElementById('newContent').value;
        const points = document.getElementById('newPoints').value.split('\n').filter(p => p.trim() !== "");
        if(!name || !content) return alert("Ø§Ù…Ù„Ø¦ÙŠ Ø§Ù„ÙØ±Ø§ØºØ§Øª Ø£ÙˆÙ„Ø§Ù‹");

        let allData = getAllData();
        allData[name] = { content, points };
        localStorage.setItem('app_names_data', JSON.stringify(allData));
        alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!");
        document.getElementById('newName').value = "";
        document.getElementById('newContent').value = "";
        document.getElementById('newPoints').value = "";
        renderNames();
    }

    function resetAllNames() {
        if(confirm("Ù‡Ù„ Ø£Ù†ØªÙ Ù…ØªØ£ÙƒØ¯Ø©ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙˆÙ„Ù† ÙŠØªØ¨Ù‚Ù‰ Ø´ÙŠØ¡ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©.")){
            localStorage.setItem('app_names_data', JSON.stringify({}));
            renderNames();
        }
    }

    function renderNames() {
        const grid = document.getElementById('mainGrid');
        grid.innerHTML = "";
        const allData = getAllData();
        
        Object.keys(allData).forEach(name => {
            const row = document.createElement('div');
            row.className = 'name-row';
            
            const btn = document.createElement('button');
            btn.className = 'name-btn';
            btn.innerText = name;
            btn.onclick = () => openArticle(name);
            row.appendChild(btn);

            if (checkAdmin()) {
                const adminDiv = document.createElement('div');
                adminDiv.style.display = 'flex';
                adminDiv.style.gap = '5px';

                const editBtn = document.createElement('button');
                editBtn.className = 'edit-btn';
                editBtn.innerHTML = 'âœï¸';
                editBtn.onclick = () => {
                    document.getElementById('newName').value = name;
                    document.getElementById('newContent').value = allData[name].content;
                    document.getElementById('newPoints').value = allData[name].points.join('\n');
                    showSection('home');
                };

                const delBtn = document.createElement('button');
                delBtn.className = 'del-btn';
                delBtn.innerHTML = 'ğŸ—‘ï¸';
                delBtn.onclick = () => {
                    if(confirm(`Ø­Ø°Ù Ø§Ø³Ù… (${name}) Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ`)) {
                        let allData = getAllData();
                        delete allData[name];
                        localStorage.setItem('app_names_data', JSON.stringify(allData));
                        renderNames();
                    }
                };

                adminDiv.appendChild(editBtn);
                adminDiv.appendChild(delBtn);
                row.appendChild(adminDiv);
            }
            grid.appendChild(row);
        });
    }

    function openArticle(name) {
        currentName = name;
        const allData = getAllData();
        document.getElementById('articleTitle').innerText = name;
        document.getElementById('articleContent').innerText = allData[name].content;
        showSection('article');
        loadStories(name);
    }

    function showPoints() {
        const allData = getAllData();
        const list = document.getElementById('pointsList');
        list.innerHTML = allData[currentName].points.map(p => `<li>${p}</li>`).join('');
        showSection('pointsSection');
    }

    function saveStory() {
        const text = document.getElementById('userStory').value;
        if (!text) return;
        let myStories = JSON.parse(localStorage.getItem('my_stories_' + currentName) || "[]");
        myStories.push(text);
        localStorage.setItem('my_stories_' + currentName, JSON.stringify(myStories));
        document.getElementById('userStory').value = "";
        loadStories(currentName);
    }

    function loadStories(name) {
        const list = document.getElementById('storiesList');
        let myStories = JSON.parse(localStorage.getItem('my_stories_' + name) || "[]");
        list.innerHTML = myStories.map(s => `
            <div class="comment-item">${s}<br>
            ${checkAdmin() ? `<button onclick="addToPublic('${s}')" style="background:#28a745; color:white; border:none; padding:5px; border-radius:5px; margin-top:5px; cursor:pointer;">â­ Ù†Ø´Ø± Ø¹Ø§Ù…</button>` : ""}
            </div>`).join('');
    }

    function addToPublic(text) {
        let publicStories = JSON.parse(localStorage.getItem('public_stories_all') || "[]");
        publicStories.push({name: currentName, text: text});
        localStorage.setItem('public_stories_all', JSON.stringify(publicStories));
        alert("ØªÙ… Ø§Ù„Ù†Ø´Ø± ÙÙŠ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø¹Ø§Ù…!");
    }

    function renderPublicStories() {
        const div = document.getElementById('allPublicStories');
        let publicStories = JSON.parse(localStorage.getItem('public_stories_all') || "[]");
        div.innerHTML = publicStories.length ? publicStories.map(s => `
            <div class="comment-item">
                <small style="color:#d4af37">Ø¹Ù† Ø§Ø³Ù…: ${s.name}</small><br>${s.text}
            </div>`).join('') : "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ù‚Ù Ù…Ù†Ø´ÙˆØ±Ø©.</p>";
    }
</script>
</body>
</html>
