<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù„Ù‡ Ø£ÙˆÙ„Ø§Ù‹</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Reem+Kufi:wght@400;700&display=swap');
        
        :root {
            --bg: #fdfaf1; --text: #4a342e; --accent: #8b6b23; --card: #ffffff;
            --gold: linear-gradient(145deg, #bf953f, #fcf6ba, #b38728);
            --shadow: 5px 5px 15px #d1d1d1, -5px -5px 15px #ffffff;
        }

        .dark-mode {
            --bg: #2d1b0a; --text: #fcf6ba; --accent: #d4af37; --card: #3d2b1f;
            --shadow: 5px 5px 15px #1a1108, -2px -2px 10px #4a342e;
        }

        /* Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯: ÙÙˆØ§Ù†ÙŠØ³ Ù…Ø¶ÙŠØ¦Ø© Ù…Ø±Ø³ÙˆÙ…Ø© */
        .ramadan-mode {
            --bg: #0a1128; /* Ø£Ø²Ø±Ù‚ Ù„ÙŠÙ„ÙŠ Ø¹Ù…ÙŠÙ‚ */
            --text: #fceabb;
            --accent: #ffcc33;
            --card: rgba(20, 30, 70, 0.7);
            background-image: 
                url('https://www.transparenttextures.com/patterns/stardust.png'), 
                linear-gradient(rgba(10, 17, 40, 0.8), rgba(10, 17, 40, 0.8)),
                url('https://cdn.pixabay.com/photo/2017/05/20/20/19/ramadan-2329713_1280.png') !important;
            background-size: auto, cover, cover;
            background-position: center;
            background-attachment: fixed;
            --shadow: 0 0 15px rgba(255, 204, 51, 0.4);
        }

        body {
            font-family: 'Amiri', serif; background-color: var(--bg); color: var(--text);
            margin: 0; padding: 15px; transition: all 0.5s ease; direction: rtl;
        }

        .header { text-align: center; margin-top: 50px; margin-bottom: 30px; }
        .logo { 
            font-family: 'Reem Kufi', sans-serif; font-size: 4.5em; 
            background: var(--gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
            margin: 0; display: inline-block; filter: drop-shadow(2px 2px 0px #8b6b23);
            -webkit-text-stroke: 1px #8b6b23; font-weight: 700;
        }
        .slogan { font-size: 1.1em; font-style: italic; opacity: 0.9; margin-top: 5px; }

        .btn-3d {
            background: var(--card); border: none; border-radius: 20px; box-shadow: var(--shadow);
            color: var(--text); padding: 15px; margin: 10px 0; width: 100%; font-weight: bold;
            cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center;
        }
        .ramadan-mode .btn-3d {
            background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 204, 51, 0.3); color: #fceabb;
        }
        .btn-3d:active { transform: scale(0.97); }

        .tasks-table {
            width: 100%; border-collapse: collapse; margin: 20px 0; background: var(--card);
            border-radius: 15px; overflow: hidden; box-shadow: var(--shadow); border: 1px solid var(--accent);
        }
        .tasks-table th { background: var(--gold); color: #4a342e; padding: 12px; }
        .tasks-table td { padding: 15px; border-bottom: 1px solid rgba(139, 107, 35, 0.2); }

        .section { display: none; animation: fadeIn 0.4s ease; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .admin-panel { border: 2px solid var(--accent); padding: 20px; border-radius: 25px; margin-top: 40px; display: none; background: rgba(139, 107, 35, 0.1); }
        .admin-input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 12px; border: 1px solid var(--accent); background: var(--bg); color: var(--text); }
    </style>
</head>
<body>

<div class="top-left-controls" style="position:fixed; bottom:20px; left:20px; z-index:100;">
    <button onclick="toggleTheme()" style="width:50px; height:50px; border-radius:50%; background:var(--gold); border:none; cursor:pointer;">ğŸŒ“</button>
</div>

<div class="container">
    <div id="home" class="section active">
        <div class="header">
            <h1 class="logo">Ø§Ù„Ù„Ù‡ Ø£ÙˆÙ„Ø§Ù‹</h1>
            <div class="slogan">Ø³ÙŠØ±ÙˆØ§ Ø¥Ù„Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ø±Ø¬Ù‰ ÙˆÙ…ÙƒØ§Ø³ÙŠØ±</div>
        </div>
        <button class="btn-3d" onclick="showSection('moodPage')">â¤ï¸ ÙƒÙŠÙ Ø­Ø§Ù„ Ù‚Ù„Ø¨ÙƒØŸ</button>
        <button class="btn-3d" style="background:var(--gold); color:#000" onclick="showSection('namesList')">ğŸ“– Ø±Ø­Ù„Ø© Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</button>

        <div id="adminPanel" class="admin-panel">
            <h3>ğŸ›  Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
            <select id="type" class="admin-input">
                <option value="names">Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… (Ù…Ù‚Ø§Ù„Ø©)</option>
                <option value="tasks">Ù†Ù‚Ø·Ø© Ø¹Ù…Ù„ÙŠØ©</option>
            </select>
            <input type="text" id="title" class="admin-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ù‡">
            <textarea id="content" class="admin-input" rows="4" placeholder="Ø§Ù„Ù…Ø­ØªÙˆÙ‰"></textarea>
            <button class="btn-3d" onclick="saveData()">Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø© âœ“</button>
        </div>
    </div>

    <div id="namesList" class="section">
        <h2 style="text-align:center;">Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ù‡ Ø§Ù„Ø­Ø³Ù†Ù‰</h2>
        <div id="namesContainer"></div>
        <button class="btn-3d" onclick="showSection('home')">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="nameDetails" class="section">
        <h1 id="detTitle" class="logo" style="font-size:3em; display:block; text-align:center;"></h1>
        <div id="detContent" style="background:var(--card); padding:20px; border-radius:20px; white-space:pre-wrap; margin-bottom:20px;"></div>
        <div id="detTasks"></div>
        <button class="btn-3d" onclick="showSection('namesList')">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="moodPage" class="section">
        <h2 style="text-align:center;">ÙƒÙŠÙ Ø­Ø§Ù„ Ù‚Ù„Ø¨ÙƒØŸ</h2>
        <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:10px;">
            <script>
                ['Ø®Ø§Ø¦Ù', 'Ø³Ø¹ÙŠØ¯', 'Ù…ÙƒØ³ÙˆØ±', 'ØªØ§Ø¦Ù‡', 'Ù…Ø´ØªØ§Ù‚', 'Ø±Ø§Ø¶Ù'].forEach(m => {
                    document.write(`<button class="btn-3d" style="font-size:0.8em" onclick="alert('Ø³Ø£Ø¶Ø¹ Ù„ÙƒÙ Ø±Ø³Ø§Ø¦Ù„ Ù‡Ù†Ø§ Ù‚Ø±ÙŠØ¨Ø§Ù‹')">${m}</button>`);
                });
            </script>
        </div>
        <button class="btn-3d" onclick="showSection('home')">Ø±Ø¬ÙˆØ¹</button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    const ADMIN_ID = 8421694319; 
    let currentName = "";

    const firebaseConfig = { databaseURL: "https://allahfirst-b9c52-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function toggleTheme() {
        const b = document.body;
        if (b.classList.contains('dark-mode')) { b.classList.replace('dark-mode', 'ramadan-mode'); }
        else if (b.classList.contains('ramadan-mode')) { b.classList.remove('ramadan-mode'); }
        else { b.classList.add('dark-mode'); }
    }

    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
        document.getElementById(id).style.display = 'block';
        if(id === 'namesList') loadNames();
    }

    if(tg.initDataUnsafe.user?.id === ADMIN_ID) document.getElementById('adminPanel').style.display = 'block';

    // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­ÙØ¸ Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø­Ø°Ù Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª (Ø§Ø³ØªØ®Ø¯Ø§Ù… set Ù„Ù„Ù…Ù‚Ø§Ù„Ø© Ùˆ push Ù„Ù„Ù…Ù‡Ø§Ù…)
    function saveData() {
        const type = document.getElementById('type').value;
        const title = document.getElementById('title').value;
        const text = document.getElementById('content').value;
        if(!title || !text) return;

        if(type === 'names') {
            db.ref('names/' + title).set({ article: text }); // Ø§Ù„Ø­ÙØ¸ ÙƒÙ€ Object Ø«Ø§Ø¨Øª Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø§Ù„Ø¶ÙŠØ§Ø¹
        } else {
            db.ref('tasks/' + title).push(text);
        }
        alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø© Ø¨Ù†Ø¬Ø§Ø­ âœ“");
        document.getElementById('content').value = "";
    }

    function loadNames() {
        db.ref('names').on('value', s => {
            const container = document.getElementById('namesContainer');
            container.innerHTML = "";
            const data = s.val() || {};
            Object.keys(data).forEach(name => {
                const btn = document.createElement('div');
                btn.className = "btn-3d";
                btn.innerHTML = `<span>${name}</span>`;
                btn.onclick = () => {
                    currentName = name;
                    document.getElementById('detTitle').innerText = name;
                    document.getElementById('detContent').innerText = data[name].article || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù‚Ø§Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹";
                    showSection('nameDetails');
                    loadTasks();
                };
                container.appendChild(btn);
            });
        });
    }

    function loadTasks() {
        db.ref('tasks/' + currentName).on('value', s => {
            const container = document.getElementById('detTasks'); container.innerHTML = "";
            const data = s.val() || {};
            const keys = Object.keys(data);
            if(keys.length > 0) {
                let html = '<table class="tasks-table"><tr><th>#</th><th>Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</th></tr>';
                keys.forEach((k, i) => {
                    html += `<tr><td>${i+1}</td><td>${data[k]}</td></tr>`;
                });
                html += '</table>';
                container.innerHTML = html;
            }
        });
    }

    tg.ready(); tg.expand();
</script>
</body>
</html>
