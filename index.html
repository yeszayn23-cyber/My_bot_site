<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù„Ù‡ Ø£ÙˆÙ„Ø§Ù‹</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Reem+Kufi:wght@400;700&display=swap');
        
        :root {
            --bg: #fdfaf1; --text: #4a342e; --accent: #8b6b23; --card: #ffffff;
            --gold: linear-gradient(145deg, #bf953f, #fcf6ba, #b38728);
            --shadow: 5px 5px 15px #d1d1d1, -5px -5px 15px #ffffff;
        }

        .dark-mode {
            --bg: #2d1b0a; --text: #fcf6ba; --accent: #d4af37; --card: #3d2b1f;
            --shadow: 5px 5px 15px #1a1108, -2px -2px 10px #4a342e;
        }

        /* Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠ Ø§Ù„Ù„ÙŠÙ„ÙŠ Ø¨Ø§Ù„ÙÙˆØ§Ù†ÙŠØ³ Ø§Ù„Ù…Ø¶ÙŠØ¦Ø© */
        body.ramadan-mode {
            background-color: #050a1d !important;
            background-image: 
                linear-gradient(rgba(5, 10, 29, 0.8), rgba(5, 10, 29, 0.8)),
                url('https://cdn.pixabay.com/photo/2017/05/20/20/19/ramadan-2329713_1280.png') !important;
            background-size: cover !important;
            background-position: center !important;
            background-attachment: fixed !important;
            --text: #fceabb; --accent: #ffcc33; --card: rgba(20, 30, 60, 0.8);
            --shadow: 0 0 20px rgba(255, 204, 51, 0.4);
        }

        body {
            font-family: 'Amiri', serif; background-color: var(--bg); color: var(--text);
            margin: 0; padding: 15px; transition: all 0.5s ease; direction: rtl;
        }

        .header { text-align: center; margin-top: 50px; margin-bottom: 30px; }
        .logo { 
            font-family: 'Reem Kufi', sans-serif; font-size: 4.5em; 
            background: var(--gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
            margin: 0; display: inline-block; filter: drop-shadow(2px 2px 0px #8b6b23);
            -webkit-text-stroke: 1px #8b6b23; font-weight: 700;
        }

        .btn-3d {
            background: var(--card); border: none; border-radius: 20px; box-shadow: var(--shadow);
            color: var(--text); padding: 15px; margin: 10px 0; width: 100%; font-weight: bold;
            cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center;
            position: relative;
        }
        
        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø°Ù Ø§Ù„Ø­Ù…Ø±Ø§Ø¡ Ù„Ù„Ù…Ø§Ù„ÙƒØ© */
        .del-btn {
            position: absolute; left: 15px; top: 50%; transform: translateY(-50%);
            background: none; border: none; color: #ff4d4d; font-size: 1.2em;
            cursor: pointer; display: none; z-index: 10;
        }

        .ramadan-mode .btn-3d {
            background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 204, 51, 0.3); color: #fceabb;
        }

        .tasks-table {
            width: 100%; border-collapse: collapse; margin: 20px 0; background: var(--card);
            border-radius: 15px; overflow: hidden; box-shadow: var(--shadow); border: 1px solid var(--accent);
        }
        .tasks-table th { background: var(--gold); color: #4a342e; padding: 12px; }
        .tasks-table td { padding: 15px; border-bottom: 1px solid rgba(139, 107, 35, 0.2); position: relative; }

        .section { display: none; animation: fadeIn 0.4s ease; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .admin-panel { border: 2px solid var(--accent); padding: 20px; border-radius: 25px; margin-top: 40px; display: none; background: rgba(139, 107, 35, 0.1); }
        .admin-input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 12px; border: 1px solid var(--accent); background: var(--bg); color: var(--text); }
        .theme-btn { position: fixed; bottom: 20px; left: 20px; width: 50px; height: 50px; border-radius: 50%; background: var(--gold); border: none; cursor: pointer; z-index: 100; font-size: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
    </style>
</head>
<body id="mainBody">

<button class="theme-btn" onclick="toggleTheme()">ğŸŒ“</button>

<div class="container">
    <div id="home" class="section active">
        <div class="header">
            <h1 class="logo">Ø§Ù„Ù„Ù‡ Ø£ÙˆÙ„Ø§Ù‹</h1>
            <div class="slogan" style="text-align:center">Ø³ÙŠØ±ÙˆØ§ Ø¥Ù„Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ø±Ø¬Ù‰ ÙˆÙ…ÙƒØ§Ø³ÙŠØ±</div>
        </div>
        
        <button class="btn-3d" onclick="showSection('moodPage')">â¤ï¸ ÙƒÙŠÙ Ø­Ø§Ù„ Ù‚Ù„Ø¨ÙƒØŸ</button>
        <button class="btn-3d" style="background:var(--gold); color:#000" onclick="showSection('namesList')">ğŸ“– Ø±Ø­Ù„Ø© Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</button>
        <button class="btn-3d" onclick="showSection('thoughtsPage')">âœ¨ Ø®ÙˆØ§Ø·Ø± ÙˆØ±Ø³Ø§Ø¦Ù„</button>

        <div id="adminPanel" class="admin-panel">
            <h3 style="text-align:center">ğŸ›  Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø§Ù„ÙƒØ©</h3>
            <select id="type" class="admin-input">
                <option value="names">Ø¥Ø¶Ø§ÙØ© Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯ (Ù…Ù‚Ø§Ù„Ø©)</option>
                <option value="thoughts">Ø¥Ø¶Ø§ÙØ© Ø®Ø§Ø·Ø±Ø©</option>
                <option value="tasks">Ù†Ù‚Ø·Ø© Ø¹Ù…Ù„ÙŠØ© Ù„Ø§Ø³Ù…</option>
            </select>
            <input type="text" id="title" class="admin-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ù‡ Ø£Ùˆ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø®Ø§Ø·Ø±Ø©">
            <textarea id="content" class="admin-input" rows="4" placeholder="Ø§Ù„Ù…Ø­ØªÙˆÙ‰..."></textarea>
            <button class="btn-3d" style="background:var(--gold)" onclick="saveData()">Ù†Ø´Ø± Ø§Ù„Ø¢Ù† âœ“</button>
        </div>
    </div>

    <div id="namesList" class="section">
        <h2 style="text-align:center">Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ù‡ Ø§Ù„Ø­Ø³Ù†Ù‰</h2>
        <div id="namesContainer"></div>
        <button class="btn-3d" onclick="showSection('home')">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="nameDetails" class="section">
        <h1 id="detTitle" class="logo" style="font-size:3em; display:block; text-align:center"></h1>
        <div id="detContent" style="background:var(--card); padding:20px; border-radius:20px; white-space:pre-wrap; margin-bottom:20px; position:relative"></div>
        <div id="detTasks"></div>
        <button class="btn-3d" onclick="showSection('namesList')">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="thoughtsPage" class="section">
        <h2 style="text-align:center">Ø®ÙˆØ§Ø·Ø± Ø¥ÙŠÙ…Ø§Ù†ÙŠØ©</h2>
        <div id="thoughtsList"></div>
        <button class="btn-3d" onclick="showSection('home')">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="moodPage" class="section">
        <h2 style="text-align:center">ÙƒÙŠÙ Ø­Ø§Ù„ Ù‚Ù„Ø¨ÙƒØŸ</h2>
        <div id="moodGrid" style="display:grid; grid-template-columns: repeat(3, 1fr); gap:10px"></div>
        <button class="btn-3d" onclick="showSection('home')">Ø±Ø¬ÙˆØ¹</button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    const ADMIN_ID = 8421694319; // Ù…Ø¹Ø±ÙÙƒÙ Ø§Ù„Ø®Ø§Øµ
    let currentName = "";

    const firebaseConfig = { databaseURL: "https://allahfirst-b9c52-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const is_admin = tg.initDataUnsafe.user?.id === ADMIN_ID;

    function toggleTheme() {
        const b = document.getElementById('mainBody');
        if (b.classList.contains('dark-mode')) { b.classList.remove('dark-mode'); b.classList.add('ramadan-mode'); }
        else if (b.classList.contains('ramadan-mode')) { b.classList.remove('ramadan-mode'); }
        else { b.classList.add('dark-mode'); }
    }

    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
        document.getElementById(id).style.display = 'block';
        if(id === 'namesList') loadNames();
        if(id === 'thoughtsPage') loadThoughts();
        if(id === 'moodPage') loadMoods();
    }

    if(is_admin) document.getElementById('adminPanel').style.display = 'block';

    function saveData() {
        const type = document.getElementById('type').value;
        const title = document.getElementById('title').value;
        const text = document.getElementById('content').value;
        if(!title || !text) return;

        if(type === 'names') db.ref('names/' + title).set({ article: text });
        else db.ref(type + '/' + title).push(text);
        
        alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­ âœ“");
        document.getElementById('content').value = "";
    }

    function loadNames() {
        db.ref('names').on('value', s => {
            const container = document.getElementById('namesContainer'); container.innerHTML = "";
            const data = s.val() || {};
            Object.keys(data).forEach(name => {
                const div = document.createElement('div');
                div.className = "btn-3d";
                div.innerHTML = `<span>${name}</span> 
                    ${is_admin ? `<button class="del-btn" style="display:block" onclick="event.stopPropagation(); deleteItem('names/${name}')">ğŸ—‘ï¸</button>` : ''}`;
                div.onclick = () => {
                    currentName = name;
                    document.getElementById('detTitle').innerText = name;
                    document.getElementById('detContent').innerText = data[name].article || "";
                    showSection('nameDetails');
                    loadTasks();
                };
                container.appendChild(div);
            });
        });
    }

    function loadTasks() {
        db.ref('tasks/' + currentName).on('value', s => {
            const container = document.getElementById('detTasks'); container.innerHTML = "";
            const data = s.val() || {};
            const keys = Object.keys(data);
            if(keys.length > 0) {
                let html = '<table class="tasks-table"><tr><th>#</th><th>Ø§Ù„Ù…Ù‡Ù…Ø©</th></tr>';
                keys.forEach((k, i) => {
                    html += `<tr><td>${i+1}</td><td>${data[k]} ${is_admin ? `<button onclick="deleteItem('tasks/${currentName}/${k}')" style="color:red; background:none; border:none; float:left; cursor:pointer">ğŸ—‘ï¸</button>` : ''}</td></tr>`;
                });
                html += '</table>';
                container.innerHTML = html;
            }
        });
    }

    function loadThoughts() {
        db.ref('thoughts').on('value', s => {
            const container = document.getElementById('thoughtsList'); container.innerHTML = "";
            const data = s.val() || {};
            Object.keys(data).forEach(title => {
                const subData = data[title];
                Object.keys(subData).forEach(k => {
                    container.innerHTML += `<div class="btn-3d" style="flex-direction:column; align-items:start; padding:20px">
                        <small style="color:var(--accent)">${title}</small>
                        <p style="margin:5px 0">${subData[k]}</p>
                        ${is_admin ? `<button class="del-btn" style="display:block" onclick="deleteItem('thoughts/${title}/${k}')">ğŸ—‘ï¸</button>` : ''}
                    </div>`;
                });
            });
        });
    }

    function loadMoods() {
        const moods = ['Ø®Ø§Ø¦Ù', 'Ø³Ø¹ÙŠØ¯', 'Ù…ÙƒØ³ÙˆØ±', 'ØªØ§Ø¦Ù‡', 'Ù…Ø´ØªØ§Ù‚', 'Ø±Ø§Ø¶Ù'];
        const grid = document.getElementById('moodGrid'); grid.innerHTML = "";
        moods.forEach(m => {
            const btn = document.createElement('button');
            btn.className = "btn-3d"; btn.innerText = m;
            btn.onclick = () => alert("Ø±Ø³Ø§Ø¦Ù„ Ø­Ø§Ù„ Ø§Ù„Ù‚Ù„Ø¨ Ù‚Ø±ÙŠØ¨Ø§Ù‹");
            grid.appendChild(btn);
        });
    }

    function deleteItem(path) {
        if(confirm("Ù‡Ù„ Ø£Ù†ØªÙ Ù…ØªØ£ÙƒØ¯Ø©ØŸ")) {
            db.ref(path).remove().then(() => alert("ØªÙ… Ø§Ù„Ø­Ø°Ù"));
        }
    }

    tg.ready(); tg.expand();
</script>
</body>
</html>
