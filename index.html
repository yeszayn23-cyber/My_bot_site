<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù„Ù‡ Ø£ÙˆÙ„Ø§Ù‹</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Reem+Kufi:wght@400;700&display=swap');
        
        :root {
            --bg: #fdfaf1; --text: #4a342e; --accent: #8b6b23; --card: #ffffff;
            --gold: linear-gradient(145deg, #bf953f, #fcf6ba, #b38728);
            --shadow: 5px 5px 15px #d1d1d1, -5px -5px 15px #ffffff;
        }

        .dark-mode {
            --bg: #2d1b0a; --text: #fcf6ba; --accent: #d4af37; --card: #3d2b1f;
            --shadow: 5px 5px 15px #1a1108, -2px -2px 10px #4a342e;
        }

        /* Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠ Ø§Ù„Ù…Ø·ÙˆØ±: ÙÙˆØ§Ù†ÙŠØ³ ÙˆÙ†Ø¬ÙˆÙ… Ù…Ø¶ÙŠØ¦Ø© */
        .ramadan-mode {
            --bg: #0a1128; 
            --text: #fceabb; 
            --accent: #ffcc33; 
            --card: rgba(20, 30, 70, 0.8);
            background-image: 
                url('https://www.transparenttextures.com/patterns/stardust.png'), 
                linear-gradient(rgba(10, 17, 40, 0.7), rgba(10, 17, 40, 0.7)),
                url('https://cdn.pixabay.com/photo/2017/05/20/20/19/ramadan-2329713_1280.png') !important;
            background-size: auto, cover, cover;
            background-position: center;
            background-attachment: fixed;
            --shadow: 0 0 15px rgba(255, 204, 51, 0.3);
        }

        body {
            font-family: 'Amiri', serif; background-color: var(--bg); color: var(--text);
            margin: 0; padding: 15px; transition: all 0.5s ease; direction: rtl;
        }

        .header { text-align: center; margin-top: 50px; margin-bottom: 30px; }
        .logo { 
            font-family: 'Reem Kufi', sans-serif; font-size: 4.5em; 
            background: var(--gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
            margin: 0; display: inline-block; filter: drop-shadow(2px 2px 0px #8b6b23);
            -webkit-text-stroke: 1px #8b6b23; font-weight: 700;
        }
        .slogan { font-size: 1.1em; font-style: italic; opacity: 0.9; margin-top: 5px; }

        .hijri-top { position: absolute; top: 15px; right: 15px; font-weight: bold; color: var(--accent); }

        .btn-3d {
            background: var(--card); border: none; border-radius: 20px; box-shadow: var(--shadow);
            color: var(--text); padding: 15px; margin: 10px 0; width: 100%; font-weight: bold;
            cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center;
        }
        .ramadan-mode .btn-3d {
            background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 204, 51, 0.3); color: #fceabb;
        }
        .btn-3d:active { transform: scale(0.97); }
        .btn-gold { background: var(--gold); color: #1a0f00 !important; border: 1px solid #8b6b23; }

        .circle-tasbih {
            width: 180px; height: 180px; border-radius: 50%; margin: 25px auto;
            background: var(--card); box-shadow: var(--shadow); display: flex; flex-direction: column;
            align-items: center; justify-content: center; border: 4px solid var(--accent); position: relative;
        }
        .count-num { font-size: 3.2em; font-weight: bold; background: var(--gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        .tasks-table {
            width: 100%; border-collapse: collapse; margin: 20px 0; background: var(--card);
            border-radius: 15px; overflow: hidden; box-shadow: var(--shadow); border: 1px solid var(--accent);
        }
        .tasks-table th { background: var(--gold); color: #4a342e; padding: 12px; font-weight: bold; }
        .tasks-table td { padding: 15px; border-bottom: 1px solid rgba(139, 107, 35, 0.2); text-align: right; }

        .section { display: none; animation: fadeIn 0.4s ease; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .admin-panel { border: 2px solid var(--accent); padding: 20px; border-radius: 25px; margin-top: 40px; display: none; background: rgba(139, 107, 35, 0.1); }
        .admin-input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 12px; border: 1px solid var(--accent); background: var(--bg); color: var(--text); box-sizing: border-box; }
        
        .top-left-controls { position: fixed; bottom: 20px; left: 20px; z-index: 100; }
        .theme-btn { width: 50px; height: 50px; border-radius: 50%; border: none; background: var(--gold); cursor: pointer; font-size: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .card { background: var(--card); padding: 20px; border-radius: 25px; box-shadow: var(--shadow); margin-bottom: 15px; border-right: 8px solid var(--accent); }
    </style>
</head>
<body>

<div class="hijri-top" id="hijriDate"></div>

<div class="top-left-controls">
    <button class="theme-btn" onclick="toggleTheme()">ğŸŒ“</button>
</div>

<div class="container">
    <div id="home" class="section active">
        <div class="header">
            <h1 class="logo">Ø§Ù„Ù„Ù‡ Ø£ÙˆÙ„Ø§Ù‹</h1>
            <div class="slogan">Ø³ÙŠØ±ÙˆØ§ Ø¥Ù„Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ø±Ø¬Ù‰ ÙˆÙ…ÙƒØ§Ø³ÙŠØ± ÙØ¥Ù† Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØµØ­Ø© Ø¨Ø·Ø§Ù„Ø©</div>
        </div>

        <div class="circle-tasbih" onclick="incrementGlobal()">
            <small>ï´¿ ÙˆØªØ¹Ø§ÙˆÙ†ÙˆØ§ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø± ï´¾</small>
            <div id="globalCount" class="count-num">0</div>
            <button id="adminReset" style="display:none; position:absolute; bottom:10px; background:none; border:none; cursor:pointer;" onclick="event.stopPropagation(); resetGlobal()">ğŸ”„</button>
        </div>

        <button class="btn-3d" onclick="showSection('moodPage')">â¤ï¸ ÙƒÙŠÙ Ø­Ø§Ù„ Ù‚Ù„Ø¨ÙƒØŸ</button>
        <button class="btn-3d btn-gold" onclick="showSection('namesList')">ğŸ“– Ø±Ø­Ù„Ø© Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</button>
        <button class="btn-3d" onclick="startKhalwa()">ğŸ§˜â€â™‚ï¸ Ø®Ù„ÙˆØ©</button>
        <button class="btn-3d" onclick="showSection('munajatPage')">ğŸ¤² Ù…Ù†Ø§Ø¬Ø§Ø©</button>
        <button class="btn-3d" onclick="showSection('thoughtsPage')">âœ¨ Ø±Ø³Ø§Ø¦Ù„ Ø±Ø¨Ø§Ù†ÙŠØ© ÙˆØ®ÙˆØ§Ø·Ø±</button>

        <div id="adminPanel" class="admin-panel">
            <h3 style="color:var(--accent); text-align:center;">ğŸ›  Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø§Ù„ÙƒØ©</h3>
            <select id="type" class="admin-input">
                <option value="names">Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… (Ù…Ù‚Ø§Ù„Ø©)</option>
                <option value="thoughts">Ø¥Ø¶Ø§ÙØ© Ø®Ø§Ø·Ø±Ø©</option>
                <option value="tasks">Ù†Ù‚Ø·Ø© Ø¹Ù…Ù„ÙŠØ© Ù„Ø§Ø³Ù…</option>
                <option value="moods">Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù„Ø­Ø§Ù„ Ø§Ù„Ù‚Ù„Ø¨</option>
            </select>
            <input type="text" id="title" class="admin-input" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ù…Ø«Ù„Ø§Ù‹: Ø§Ù„ÙˆØ¯ÙˆØ¯ Ø£Ùˆ Ø®Ø§Ø¦Ù)">
            <textarea id="content" class="admin-input" rows="4" placeholder="Ø§Ù„Ù…Ø­ØªÙˆÙ‰..."></textarea>
            <button class="btn-3d btn-gold" onclick="saveData()">Ù†Ø´Ø± ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø© âœ“</button>
        </div>
    </div>

    <div id="namesList" class="section">
        <h2 style="text-align:center; color:var(--accent)">Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ù‡ Ø§Ù„Ø­Ø³Ù†Ù‰</h2>
        <div id="namesContainer"></div>
        <button class="btn-3d" onclick="showSection('home')">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="nameDetails" class="section">
        <div style="text-align:center"><h1 id="detTitle" class="logo" style="font-size:3em"></h1></div>
        <div class="card" id="detContent" style="white-space:pre-wrap"></div>
        <div id="detTasks"></div>
        <div class="circle-tasbih" onclick="incrementLocal()" style="width:130px; height:130px">
            <div id="localCount" class="count-num" style="font-size:2em">0</div>
            <button style="background:none; border:none; cursor:pointer;" onclick="event.stopPropagation(); resetLocal()">ğŸ”„</button>
        </div>
        <button class="btn-3d" onclick="showSection('namesList')">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="moodPage" class="section">
        <h2 style="text-align:center; color:var(--accent)">ÙƒÙŠÙ Ø­Ø§Ù„ Ù‚Ù„Ø¨ÙƒØŸ</h2>
        <div class="mood-grid">
            <script>
                const moods = ['Ø®Ø§Ø¦Ù', 'Ø³Ø¹ÙŠØ¯', 'Ù…ÙƒØ³ÙˆØ±', 'ØªØ§Ø¦Ù‡', 'Ù…Ø´ØªØ§Ù‚', 'Ù…Ù‚Ø¨Ù„', 'Ù…Ø¯Ø¨Ø±', 'Ù‚Ù„Ù‚', 'Ù…Ø·Ù…Ø¦Ù†', 'ÙˆØ­ÙŠØ¯', 'ØºØ±ÙŠØ¨', 'Ø±Ø§Ø¶Ù'];
                moods.forEach(m => {
                    document.write(`<button class="btn-3d" style="font-size:0.8em" onclick="openMood('${m}')">${m}</button>`);
                });
            </script>
        </div>
        <button class="btn-3d" onclick="showSection('home')">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="thoughtsPage" class="section">
        <h2 style="text-align:center; color:var(--accent)">Ø®ÙˆØ§Ø·Ø± Ø¥ÙŠÙ…Ø§Ù†ÙŠØ©</h2>
        <div id="thoughtsList"></div>
        <button class="btn-3d" onclick="showSection('home')">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="munajatPage" class="section">
        <div class="card">
            <h3>Ù†Ø§Ø¬Ù Ø±Ø¨Ùƒ..</h3>
            <textarea id="munajatInput" class="admin-input" rows="8" placeholder="ØªØ­Ø¯Ø« Ù…Ø¹ Ø§Ù„Ù„Ù‡..."></textarea>
            <button class="btn-3d btn-gold" onclick="sendMunajat()">Ø£Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ù„Ù‡ Ù‚Ù„Ø¨ÙŠ âœ¨</button>
        </div>
        <button class="btn-3d" onclick="showSection('home')">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="khalwaPage" class="section" style="position:fixed; top:0; left:0; width:100%; height:100%; background:var(--bg); z-index:1000; display:none;">
        <div id="khalwaText" style="height:100%; display:flex; align-items:center; justify-content:center; padding:30px; font-size:2em; text-align:center; transition:2s"></div>
        <button class="btn-3d" style="position:absolute; bottom:20px; width:80%; left:10%;" onclick="stopKhalwa()">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø®Ù„ÙˆØ©</button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    const ADMIN_ID = 8421694319;
    let currentName = "";

    const firebaseConfig = { databaseURL: "https://allahfirst-b9c52-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    document.getElementById('hijriDate').innerText = new Intl.DateTimeFormat('ar-SA-u-ca-islamic-umalqura', {day:'numeric', month:'long', year:'numeric'}).format(new Date());

    function toggleTheme() {
        const body = document.body;
        if (body.classList.contains('dark-mode')) { body.classList.replace('dark-mode', 'ramadan-mode'); }
        else if (body.classList.contains('ramadan-mode')) { body.classList.remove('ramadan-mode'); }
        else { body.classList.add('dark-mode'); }
    }

    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
        document.getElementById(id).style.display = 'block';
        if(id === 'namesList') loadNames();
        if(id === 'thoughtsPage') loadThoughts();
    }

    function incrementGlobal() { db.ref('global_count').transaction(c => (c || 0) + 1); }
    db.ref('global_count').on('value', s => { document.getElementById('globalCount').innerText = s.val() || 0; });
    function resetGlobal() { if(confirm("ØªØµÙÙŠØ± Ø§Ù„Ø³Ø¨Ø­Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©ØŸ")) db.ref('global_count').set(0); }

    let localCount = 0;
    function incrementLocal() { localCount++; document.getElementById('localCount').innerText = localCount; }
    function resetLocal() { localCount = 0; document.getElementById('localCount').innerText = 0; }

    if(tg.initDataUnsafe.user?.id === ADMIN_ID) {
        document.getElementById('adminPanel').style.display = 'block';
        document.getElementById('adminReset').style.display = 'block';
    }

    function saveData() {
        const type = document.getElementById('type').value;
        const title = document.getElementById('title').value;
        const text = document.getElementById('content').value;
        if(!title || !text) return;

        if(type === 'names') {
            db.ref('names/' + title).set({ article: text }); // Ø­ÙØ¸ Ø§Ù„Ù…Ù‚Ø§Ù„ Ø¨Ø´ÙƒÙ„ Ù…Ø­Ù…ÙŠ
        } else {
            db.ref(type + '/' + title).push(text);
        }
        alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø© âœ“");
        document.getElementById('content').value = "";
    }

    function loadNames() {
        db.ref('names').on('value', s => {
            const container = document.getElementById('namesContainer');
            container.innerHTML = "";
            const data = s.val() || {};
            Object.keys(data).forEach(name => {
                const btn = document.createElement('div');
                btn.className = "btn-3d";
                btn.innerHTML = `<span>${name}</span>`;
                btn.onclick = () => {
                    currentName = name;
                    document.getElementById('detTitle').innerText = name;
                    document.getElementById('detContent').innerText = data[name].article || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù‚Ø§Ù„";
                    showSection('nameDetails');
                    loadSubData();
                };
                container.appendChild(btn);
            });
        });
    }

    function loadSubData() {
        db.ref('tasks/' + currentName).on('value', s => {
            const container = document.getElementById('detTasks'); container.innerHTML = "";
            const data = s.val() || {};
            const keys = Object.keys(data);
            if(keys.length > 0) {
                let html = '<table class="tasks-table"><tr><th>#</th><th>Ø§Ù„Ù…Ù‡Ù…Ø©</th></tr>';
                keys.forEach((k, i) => {
                    html += `<tr><td>${i+1}</td><td>${data[k]} ${tg.initDataUnsafe.user?.id === ADMIN_ID ? `<button onclick="db.ref('tasks/${currentName}/${k}').remove()" style="color:red; background:none; border:none; float:left;">ğŸ—‘ï¸</button>` : ''}</td></tr>`;
                });
                html += '</table>';
                container.innerHTML = html;
            }
        });
    }

    function openMood(m) {
        db.ref('moods/' + m).once('value', s => {
            const data = s.val() || {};
            const msg = Object.values(data)[0] || "Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ø±Ø³Ø§Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø´Ø¹ÙˆØ± âœ¨";
            alert(msg);
        });
    }

    function loadThoughts() {
        db.ref('thoughts').on('value', s => {
            const container = document.getElementById('thoughtsList'); container.innerHTML = "";
            const data = s.val() || {};
            Object.keys(data).forEach(k => {
                const thought = Object.values(data[k])[0];
                container.innerHTML += `<div class="card"><h3>${k}</h3><p>${thought}</p></div>`;
            });
        });
    }

    function startKhalwa() {
        const ayahs = ["Ø£ÙÙ„ÙÙŠÙ’Ø³Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ø¨ÙÙƒÙØ§ÙÙ Ø¹ÙØ¨Ù’Ø¯ÙÙ‡Ù", "ÙÙØ¥ÙÙ†Ù‘ÙÙŠ Ù‚ÙØ±ÙÙŠØ¨ÙŒ", "Ù„ÙØ§ ØªÙØ­Ù’Ø²ÙÙ†Ù’ Ø¥ÙÙ†Ù‘Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ù…ÙØ¹ÙÙ†ÙØ§", "Ø£ÙÙ„ÙØ§ Ø¨ÙØ°ÙÙƒÙ’Ø±Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù ØªÙØ·Ù’Ù…ÙØ¦ÙÙ†Ù‘Ù Ø§Ù„Ù’Ù‚ÙÙ„ÙÙˆØ¨Ù"];
        document.getElementById('khalwaPage').style.display = 'block';
        const t = document.getElementById('khalwaText');
        let i = 0;
        window.kInt = setInterval(() => {
            t.style.opacity = 0;
            setTimeout(() => { t.innerText = ayahs[i % ayahs.length]; t.style.opacity = 1; i++; }, 1000);
        }, 5000);
        t.innerText = "Ø£ØºÙ„Ù‚ Ø¹ÙŠÙ†ÙŠÙƒ ÙˆØ§Ø³ØªØ´Ø¹Ø± Ø§Ù„Ù…Ø¹ÙŠØ©..";
    }

    function stopKhalwa() { clearInterval(window.kInt); document.getElementById('khalwaPage').style.display = 'none'; }
    function sendMunajat() { alert("ØªÙ… Ø§Ø³ØªÙŠØ¯Ø§Ø¹ Ø±Ø³Ø§Ù„ØªÙƒ ÙÙŠ Ù…Ù„ÙƒÙˆØª Ø§Ù„Ù„Ù‡.."); document.getElementById('munajatInput').value = ""; showSection('home'); }

    tg.ready(); tg.expand();
</script>
</body>
</html>
